#!/usr/bin/env node

//config
var plugins_home = '../plugins';

var system_type = 'graphite';
var config = {
    graphite_host : 'stats01-smc03',
    graphite_port : '2003',
    graphite_namespace : 'nervous.www02-smc03'
};

//deps
var fs = require('fs');
var axon_factory = require('../lib/axon_factory')( system_type, config );
var path = require('path');

//code
var full_path_of_test_js =  require.resolve( plugins_home + '/test.js' );
var full_plugins_path = path.dirname( full_path_of_test_js ) + '/node_modules';

var load_plugins = function () {
    fs.readdir( full_plugins_path, function( err, entries ) {
	    var dirs = [];
	    entries = entries || [];
	    entries.forEach( function( entry ) {
		    
		    var plugin = full_plugins_path + '/' + entry;
		    fs.stat( plugin, function( err, stats ) {
			    if ( stats.isDirectory() ) {
				require( plugin )( axon_factory( entry ) );
			    }
			} );	
	    } );
	    

	}

	);
};

    
load_plugins();
